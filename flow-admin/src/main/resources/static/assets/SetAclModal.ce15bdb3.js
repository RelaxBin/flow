var e=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(o,a,t)=>a in o?e(o,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[a]=t,l=(e,o,a)=>new Promise(((t,r)=>{var s=e=>{try{l(a.next(e))}catch(o){r(o)}},i=e=>{try{l(a.throw(e))}catch(o){r(o)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,i);l((a=a.apply(e,o)).next())}));import{B as n,a as c}from"./index.dcc0b3b8.js";import{_ as d}from"./TableImg.5bb7b2c3.js";import{_ as u}from"./BasicForm.3145f6c6.js";import{u as m}from"./useTable.4693838b.js";import{u as p}from"./useForm.f6c4fcf0.js";import{b,d as f}from"./group.data.b381cd4d.js";import{b as h}from"./account.19888dcd.js";import{_ as g,g as v,s as j}from"./AclCheckboxGroup.b492e7a2.js";import{y as x,bx as k,aX as C,r as S,u as y,Z as A,B,F as I,a2 as O,v as T,a0 as w,a9 as F}from"./vendor.880b4c6c.js";/* empty css              */import{aS as M}from"./index.8bbed969.js";import"./useWindowSizeFn.564cf32e.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./uuid.2b29000c.js";import"./onMountedOrActivated.8f899bfb.js";/* empty css              */import"./useSortable.9bed7e43.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.a0306c89.js";/* empty css              *//* empty css              *//* empty css              */import"./download.92b34d7b.js";import"./base64Conver.bb012c73.js";import"./index.adea3535.js";var P=x({name:"SetAclModal",components:{BasicModal:n,BasicTable:d,BasicForm:u,Select:k,Checkbox:C,CheckboxGroup:C.Group,AclCheckboxGroup:g},emits:["success","register"],setup(e,{emit:n}){const d=S(!0),u=S(""),g=S([]),x=S(!0),k=S(!1),C=S(!1),[A,{setFieldsValue:B,updateSchema:I,resetFields:O,validate:T}]=p({labelWidth:100,schemas:b,showActionButtonGroup:!1,actionColOptions:{span:0}}),[w,{getDataSource:F,setTableData:P,reload:R,expandAll:_}]=m({title:"",size:"small",dataSource:g,loading:x,immediate:!1,searchInfo:{},columns:f,formConfig:{labelWidth:120},canResize:!0,maxHeight:400,isTreeTable:!0,useSearchForm:!1,showTableSetting:!1,bordered:!1,showIndexColumn:!1,pagination:!1}),[G,{setModalProps:L,closeModal:U}]=c((e=>l(this,null,(function*(){if(O(),L({confirmLoading:!1,title:"给组【"+e.record.name+"("+e.record.sn+")】设置权限"}),d.value=!!(null==e?void 0:e.isUpdate),y(d)){let n=e.record.groups||[];n=n.map((e=>e.id)),B((l=((e,o)=>{for(var a in o||(o={}))r.call(o,a)&&i(e,a,o[a]);if(t)for(var a of t(o))s.call(o,a)&&i(e,a,o[a]);return e})({},e.record),o(l,a({groups:n})))),u.value=e.record.id}var l;x.value=!0,v({groupId:e.record.id}).then((e=>{z(e),g.value=e,x.value=!1,setTimeout((()=>{_()}))}))}))));function z(e){let o=0,a=0,t=0;M(e,(e=>{e.pvs&&e.pvs.forEach((e=>{o++,e.flag?a++:t++}))})),a===o?(C.value=!0,k.value=!1):t===o?(C.value=!1,k.value=!1):k.value=!0}return{registerTable:w,registerModal:G,indeterminate:k,registerForm:A,checkAllBox:C,handelChangeCheckAllStatus:function(){v({groupId:u.value}).then((e=>{z(e)}))},checkAll:e=>{x.value=!0,k.value=!1,j({checked:e.target.checked?1:0,aclInfo:{releaseId:y(u)}}).then((o=>{M(g.value,(o=>{o.pvs&&o.pvs.forEach((o=>{o.flag=e.target.checked}))})),P(g.value),x.value=!1,setTimeout((()=>{_()}))})).catch((()=>{x.value=!1}))},handleSubmit:function(){return l(this,null,(function*(){try{L({confirmLoading:!0});const e=yield T();e.groups=e.groups.map((e=>({id:e}))),e.userId=e.id,delete e.id,yield h(e),U(),n("success")}finally{L({confirmLoading:!1})}}))}}}});const R=F("全选");P.render=function(e,o,a,t,r,s){const i=A("Checkbox"),l=A("AclCheckboxGroup"),n=A("BasicTable"),c=A("BasicForm"),d=A("BasicModal");return B(),I(d,w(e.$attrs,{onRegister:e.registerModal,onOk:e.handleSubmit}),{default:O((()=>[T(c,{onRegister:e.registerForm},{acls:O((({model:a,field:t})=>[T(n,{value:a[t],"onUpdate:value":e=>a[t]=e,onRegister:e.registerTable},{customTitle:O((()=>[T("span",null,[T(i,{checked:e.checkAllBox,"onUpdate:checked":o[1]||(o[1]=o=>e.checkAllBox=o),indeterminate:e.indeterminate,onClick:e.checkAll},{default:O((()=>[R])),_:1},8,["checked","indeterminate","onClick"])])])),pvs:O((({record:o})=>[T(l,{onChangeCheckAllStatus:e.handelChangeCheckAllStatus,checkboxList:o.pvs.map((e=>({label:e.name,value:e.position,checked:e.flag}))),groupId:a.id,moduleSn:o.sn,moduleId:o.id},null,8,["onChangeCheckAllStatus","checkboxList","groupId","moduleSn","moduleId"])])),_:2},1032,["value","onUpdate:value","onRegister"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","onOk"])};export default P;
